# ДСТУ 8302:2015 Citation Style

Реалізація формату цитування для стандарту **ДСТУ 8302:2015** (Інформація та документація. Бібліографічне посилання. Загальні положення та правила складання).

## Вимоги стандарту

### Функціональність
- ✅ Сортування по алфавіту, спочатку українські джерела, потім англійські
- ✅ Якщо мова джерела не вказана, це автоматично англійська
- ✅ Відповідне форматування для різних типів джерел (книги, статті, патенти, стандарти, вебсайти тощо)
- ✅ Коректна пунктуація та відступи

### Структура проекту

```
zotero-dstu-8302-2015/
├── dstu-8302-2015.csl          # Основний CSL файл стилю (у корені)
├── run-server.sh               # Скрипт запуску веб-сервера
├── playwright.config.js        # Конфіг для Playwright тестів (ES6 модулі)
├── tests/                       # Директорія для тестів
│   ├── dstu-8302-2015.spec.js  # Playwright E2E тести (ES6 import)
│   └── test-cases/             # Модульні тестові випадки (кожна категорія у окремому файлі)
│       ├── index.js            # Центральний експорт всіх тестів
│       ├── books.js            # Тести для книг
│       ├── journal-articles.js # Тести для статей у журналах
│       ├── chapters.js         # Тести для розділів книг
│       ├── theses.js           # Тести для дисертацій
│       ├── patents.js          # Тести для патентів
│       ├── standards.js        # Тести для стандартів
│       ├── web-resources.js    # Тести для веб-сайтів
│       ├── conference-papers.js # Тести для матеріалів конференцій
│       ├── user-articles.js    # Тести власних статей
│       └── sorting.js          # Тести сортування
├── package.json                # Залежності npm (type: "module")
└── citeproc-node/              # Веб-сервер цитування
    ├── csl/                    # Директорія зі CSL файлами (включає копію dstu-8302-2015.csl)
    ├── lib/                    # Основні модулі сервера
    ├── config/                 # Конфіг сервера
    └── package.json            # Залежності для сервера
```

## Налаштування та запуск

## Вимоги
- Node.js v22+ 
- npm або yarn

## Встановлення

1. **Клонуємо репозиторій та встановлюємо залежності:**

```bash
git clone https://github.com/EarlOld/zotero-dstu-8302-2015.git
cd zotero-dstu-8302-2015
npm install
```

2. **Отримуємо citeproc-node та його залежності (CSL стилі та локалізації):**

```bash
# Клонуємо веб-сервер цитування
git clone https://github.com/zotero/citeproc-node.git

# Отримуємо CSL 1.0 стилі
git clone https://github.com/citation-style-language/styles.git citeproc-node/csl

# Отримуємо CSL локалізаційні файли
git clone https://github.com/citation-style-language/locales.git citeproc-node/csl-locales
```

3. **Встановлюємо залежності для веб-сервера:**

```bash
cd citeproc-node
npm install
cd ..
```

**Примітка:** `citeproc-node/` є зовнішнім репозиторієм і не комітиться у цей проект. Переконайтеся, що директорія вилучена з `.gitignore` або використовується як git submodule.

## Запуск проекту

### Запуск веб-сервера

Сервер запускається на порту 8085 з кастомним ДСТУ 8302:2015 стилем:

```bash
npm run start:server
```

**Що робить скрипт:**
1. Копіює `dstu-8302-2015.csl` у директорію `citeproc-node/csl/`
2. Запускає веб-сервер на `http://localhost:8085`

Сервер буде доступний за адресою `http://localhost:8085`

## Тестування

### Запуск тестів (рекомендується)

Проект використовує **Playwright** для E2E тестування з ES6 модулями:

```bash
# Спочатку запустіть сервер в іншому терміналі
npm run start:server

# Потім запустіть тести у іншому терміналі
npm test
```

### Структура тестів

Тестові випадки організовані модульно у директорії `tests/test-cases/`:

- **books.js** - 2 тести (одного та двох авторів)
- **journal-articles.js** - 8 тестів (українські та англійські статті)
- **chapters.js** - 1 тест (розділи книг)
- **theses.js** - 1 тест (дисертації)
- **patents.js** - 1 тест (патенти)
- **standards.js** - 1 тест (стандарти)
- **web-resources.js** - 1 тест (веб-сайти)
- **conference-papers.js** - 1 тест (матеріали конференцій)
- **user-articles.js** - 3 тести (власні статті з CrossRef metadata)
- **sorting.js** - 1 тест (українське-перше сортування)

Всього: **20 тестів**, всі проходять ✓

### Додаткові опції Playwright

```bash
# Запуск з UI
npm run test:playwright:ui

# Запуск зDebugger
npm run test:playwright:debug

# Запуск у видимому браузері
npm run test:playwright:headed
```

## Використання

### HTTP API

Для форматування бібліографії відправляємо POST запит на сервер:

```bash
curl -X POST 'http://localhost:8085/?style=dstu-8302-2015&bibliography=1' \
  -H "Content-Type: application/json" \
  -d '{
    "items": {
      "ITEM-1": {
        "id": "ITEM-1",
        "title": "Назва книги",
        "author": [{"family": "Прізвище", "given": "Ім'\''я"}],
        "type": "book",
        "publisher": "Видавництво",
        "publisher-place": "Місто",
        "issued": {"date-parts": [[2020]]},
        "number-of-pages": "285"
      }
    }
  }'
```

### Параметри запиту

| Параметр | Значення | Опис |
|----------|----------|------|
| `style` | `dstu-8302-2015` | Код стилю |
| `bibliography` | `1` | Отримати бібліографічний список |
| `citations` | `1` | Отримати in-text цитування |
| `locale` | `uk-UA` або `en` | Мова локалізації |

## Підтримуваний типи джерел

- `book` - Книга
- `article-journal` - Стаття в журналі
- `article-magazine` - Стаття в газеті/журналі
- `article-newspaper` - Стаття в газеті
- `chapter` - Розділ книги
- `thesis` - Дисертація/автореферат
- `patent` - Патент
- `standard` - Стандарт (ДСТУ, ГОСТ)
- `webpage` - Веб-сайт
- `paper-conference` - Матеріал конференції
- `report` - Технічний звіт

## Приклади форматування

### Книга одного автора
```
Маркін М. О. Телевізійні інформаційно-вимірювальні системи : монографія. Київ : КПІ ім. Ігоря Сікорського, 2020. 285 с.
```

### Книга двох авторів
```
Маркін М. О., Маркіна О. М. Формування вхідного сигналу в телевізійній інформаційно-вимірювальній системі : навч. посіб. Київ : КПІ ім. Ігоря Сікорського, 2021. 156 с.
```

### Стаття в журналі
```
Маркін М. О. Оцінка точності вимірювання геометричних параметрів за допомогою телевізійних інформаційно-вимірювальних систем. Вісник КПІ. Серія "Приладобудування". 2020. Вип. 59, № 1. С. 78—85.
```

### ДСТУ стандарт
```
ДСТУ 8302:2015. Інформація та документація. Бібліографічне посилання. Загальні положення та правила складання. Чинний від 2016-07-01. Вид. офіц. Київ : УкрНДНЦ, 2016. 16 с.
```

### Веб-сайт
```
Національний банк України. Офіційний курс долара США щодо гривні. URL: https://bank.gov.ua/ua/markets/exchangerates (дата звернення: 15.03.2024).
```

## Розширення та налаштування

### Модифікація CSL стилю

Основний файл стилю: `dstu-8302-2015.csl`

Для зміни форматування редагуйте macros та bibliography sections у XML файлі.

## Розробка

### Додавання нових тестів

Тести організовані у окремих модулях. Щоб додати новий тест:

1. Відкрийте відповідний файл у `tests/test-cases/` (наприклад `books.js`)
2. Додайте новий об'єкт у масив:

```javascript
{
  name: 'Опис тесту',
  data: {
    items: {
      'ITEM-N': {
        id: 'ITEM-N',
        title: 'Назва',
        author: [{ family: 'Прізвище', given: 'Ім\'я' }],
        type: 'book',
        // ... інші поля
      }
    },
    bibliography: true
  },
  expected: 'Очікуваний результат форматування'
}
```

Або для перевірки конкретного вмісту замість точного збігу:

```javascript
{
  name: 'Опис тесту',
  data: { /* ... */ },
  checks: [
    (output) => output.includes('текст для пошуку'),
    (output) => output.includes('ще текст')
  ]
}
```

3. Тест буде автоматично включено через `tests/test-cases/index.js`

### Використання ES6 модулів

Весь код проекту використовує ES6 синтаксис:

```javascript
// Імпорт
import { BOOKS, JOURNAL_ARTICLES } from './test-cases/index.js';

// Експорт
export default [
  { name: 'Test', data: {}, expected: 'result' }
];
```

Конфіг: `package.json` містить `"type": "module"`

## Ліцензія

Creative Commons Attribution-ShareAlike 3.0 License

## Посилання

- [ДСТУ 8302:2015 - Офіційна документація](https://ivt.kpi.ua/dstu-83022015-bibliografichne-posylannya/)
- [Citation Style Language (CSL) - Документація](https://citeproc-js.readthedocs.io/)
- [Citeproc.js Server GitHub](https://github.com/zotero/citeproc-js-server)

## Автор

EarlOld - розробник стилю для ДСТУ 8302:2015

---

**Остання оновлення:** 26 січня 2026 р.
